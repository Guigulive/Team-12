### 智能合约代码

>  完成今天的智能合约添加100eth到合约中，加入10个员工，每个员工的薪水都是1eth

详见【智能合约代码】

### gas变化的记录

每次加入一个员工后调用calculateRunway这个函数，并且记录消耗的gas是多少？

|        | **transaction cost** | **execution cost** |
| ------ | -------------------- | ------------------ |
| **1**  | 22966                | 1694               |
| **2**  | 23747                | 2475               |
| **3**  | 24528                | 3256               |
| **4**  | 25309                | 4037               |
| **5**  | 26090                | 5599               |
| **6**  | 27652                | 6380               |
| **7**  | 28433                | 7161               |
| **8**  | 29214                | 7942               |
| **9**  | 29995                | 8723               |
| **10** | 30776                | 9504               |

### gas变化的原因

gas变化吗？如果有，为什么？

```js
function calculateRunway() returns (uint) {
    uint totalSalary = 0;
    for(uint i = 0; i < employees.length; i++) {
        totalSalary += employees[i].salary;
    }        
    return this.balance / totalSalary;
}
```

-  每次运行函数`calculateRunway`的时候，都要执行for循环语句。每次添加一个员工，就要多遍历一次。遍历数组的过程中要执行各种各样的比较，比较的过程中就会消耗gas



### calculateRunway函数的优化

>  如何优化calculateRunway这个函数来减少gas的消耗？

详见【calculateRunway函数的优化】

**改进思路**：

函数`calculateRunway() `调用for的很多运算是重复消耗的，比如每新加入一个employee，就将之前的salary重新叠加，而之前成员的salary叠加在不更改的情况下一直是固定值。因此我修改为在每次add/remove/update employee时即时对totalSalary进行叠加或修改运算，避免计算冗余。

**改进结果**：

不管employee有多少，gas的消耗都是恒定的。

transaction cost : 22124 gas， execution cost : 852 gas 



